from fastapi import Request

TRANSLATIONS = {
    "zh": {
        "Software": "软件资源",
        "Compute": "计算资源",
        "Data": "数据资源",
        "Teaching": "教学资源",
        "API": "API服务",
        "Other": "其他资源",
        "Resource Catalog": "资源目录",
        "My Resources": "我的资源",
        "Login via SWUFE Unified Auth": "使用 SWUFE 统一认证账户登陆",
        "Login to Apply": "登录并申请",
        "Logout": "退出登录",
        "Resource Authorization Platform": "资源授权管理平台",
        "Download Installer": "下载安装包",
        "Download License": "下载授权文件",
        "Apply / Request Access": "申请访问权限",
        "Instant Approval": "自动秒批",
        "Requires Manual Audit": "需人工审核",
        "Pending Approval...": "审批中...",
        "Already Authorized": "已获得授权",
        "Authentication required": "需要身份验证",
        "Expires": "有效期至",
        "Admin Console": "管理控制台",
        "Pending Approvals": "待审批申请",
        "Active Resources": "活跃资源",
        "Total Requests": "总申请数",
        "App ID": "申请编号",
        "Priority": "优先级",
        "User Info": "用户信息",
        "Resource": "资源",
        "Submission Details": "提交详情",
        "Time": "时间",
        "Actions": "操作",
        "HIGH": "高",
        "NORMAL": "普通",
        "No pending applications": "暂无待审批申请",
        "Resource Configuration": "资源配置",
        "Edit": "编辑",
        "Delete": "删除",
        "Top Requested Resources": "热门资源",
        "Recent Audit Logs": "最近审计日志",
        "Admin": "管理员",
        "Action": "动作",
        "Details": "详情",
        "IP": "IP地址",
        "Reject Application": "拒绝申请",
        "Reason for Rejection": "拒绝原因",
        "Cancel": "取消",
        "Submit Application": "提交申请",
        "New Resource Wizard": "新建资源向导",
        "Resource Name": "资源名称",
        "Category": "分类",
        "Description / Introduction": "描述 / 介绍",
        "Valid Until (Expiry Date)": "有效期至",
        "Authorization Type": "授权类型",
        "Public Installer URL (All Software)": "安装包下载链接 (通用)",
        "Upload Auth/License ZIP": "上传授权/License压缩包",
        "Inject Filename": "注入文件名",
        "License Code / Key": "License 代码 / Key",
        "Instruction Text": "指引文本",
        "Usage Norms / Agreement": "使用规范 / 协议",
        "Connection Info Template": "连接信息模板",
        "Default Token Quota": "默认 Token 配额",
        "Upstream API Endpoint": "上游 API 地址",
        "Wait...": "请稍候...",
        "Usage Description": "用途说明",
        "No resources available in this category.": "该分类下暂无资源。",
        "Apply for Resource": "申请资源",
        "Decrypt Tool": "Trace 解密工具",
        "Active": "已激活",
        "License Code": "授权码",
        "Activation Guide": "激活指南",
        "Refer to email for access instructions.": "请查阅邮件获取访问说明。",
        "No approved resources yet.": "暂无已授权资源。",
        "View Details": "查看详情",
        "Close": "关闭",
        "Reason": "原因",
        "Describe the resource features and version...": "描述资源特性和版本...",
        "Paste license key or code here...": "在此粘贴 License Key 或代码...",
        "Loading preview...": "正在加载预览...",
        "Empty Archive": "压缩包为空",
        "Archive Preview (Unsaved)": "压缩包预览 (未保存)",
        "Preview Error": "预览错误",
        "User Management": "用户管理",
        "Approve": "批准",
        "Reject": "拒绝",
        "Legacy Storage. Re-upload required.": "旧版存储格式，请重新上传。",
        "Are you sure?": "确认执行此操作吗？",
        "requests": "次申请",
        "Are you sure you want to reject this application?": "确定要拒绝此申请吗？",
        "Not eligible...": "不符合条件...",
        "Re-apply": "重新申请",
        "Previous Status": "历史状态",
        "Re-apply for Resource": "重新申请资源",
        "E-TRAP Login": "E-TRAP 登录",
        "Experimental Teaching Resource Authorization Platform": "实验教学资源授权平台",
        "Dev Mode: Any username creates a new user.": "开发模式：任意用户名自动创建新用户。",
        "Student/Staff ID": "学工号",
        "Enter your ID": "输入您的学工号",
        "Password": "密码",
        "Enter Password": "输入密码",
        "Login": "登录",
        "Create an Account": "创建账号",
        "Register": "注册",
        "Name": "姓名",
        "Department": "学院/部门",
        "Phone": "电话",
        "Email": "邮箱",
        "Already have an account? Login": "已有账号？登录",
        "Complete Profile": "完善个人信息",
        "Please complete your profile to continue.": "请完善您的个人信息以继续。",
        "Register New User": "注册新用户",
        "Student/Staff ID (Unique)": "学工号 (唯一)",
        "Unique ID (e.g. 2021001)": "唯一ID (如 2021001)",
        "Full Name": "姓名",
        "Your Name": "您的姓名",
        "Department (School)": "学院/部门",
        "e.g. School of Finance": "例如：金融学院",
        "Phone Number": "电话号码",
        "Email Address": "邮箱地址",
        "Register & Login": "注册并登录",
        "Complete Your Profile": "完善您的资料",
        "You must update your contact info to continue.": "请更新您的联系方式以继续。",
        "Save & Continue": "保存并继续",
        "Decrypt Trace Info": "解密追踪信息",
        "Back to Dashboard": "返回仪表盘",
        "Upload Encrypted File (e.g. lic.dat)": "上传加密文件 (如 lic.dat)",
        "Decrypt": "解密",
        "Decrypted Result:": "解密结果：",
        "User ID (DB)": "用户ID (DB)",
        "Username (SWUFE UID)": "用户名 (学工号)",
        "Application ID": "申请ID",
        "Apply Time (Approved)": "申请时间 (批准时)",
        "Download Time": "下载时间",
        "User Management - E-TRAP Admin": "用户管理 - E-TRAP 管理后台",
        "Dashboard": "仪表盘",
        "Search name/ID/email": "搜索姓名/学号/邮箱",
        "Search": "搜索",
        "UID": "学号",
        "Role": "角色",
        "Status": "状态",
        "Actions": "操作",
        "Disabled": "已禁用",
        "No users found": "未找到用户",
        "Details": "详情",
        "User Detail - E-TRAP Admin": "用户详情 - E-TRAP 管理后台",
        "Back to Users": "返回用户列表",
        "User Profile": "用户概况",
        "Disable Account": "禁用账号",
        "Enable Account": "启用账号",
        "Change Role": "修改角色",
        "Update": "更新",
        "User Applications": "用户申请记录",
        "Revoke All": "全部撤销",
        "Are you sure you want to revoke ALL active applications for this user?": "确定要撤销该用户的所有有效申请吗？",
        "Revoke access? This cannot be undone.": "确定撤销权限？此操作无法撤回。",
        "No applications found": "无申请记录",
        "Revoke": "撤销",
        "Resource": "资源",
        "Date": "日期",
        "Action": "操作",
        "Statistics": "统计",
        "Total Authorizations": "累计授权总数",
        "Active Authorizations": "当前活跃授权",
        "Expiring Soon (7 Days)": "即将到期 (7天内)",
        "Authorization Trends": "授权趋势",
        "Authorization Distribution": "授权分布",
        "Start Date": "开始日期",
        "End Date": "结束日期",
        "Filter": "筛选",
        "Resource Name": "资源名称",
        "Category": "分类",
        "Count": "数量",
        "No data available": "暂无数据",
        "Steps": "步骤",
        "General Info": "基本信息",
        "Access Control": "访问控制",
        "Configuration": "配置",
        "Review": "审核",
        "Exit Wizard": "退出向导",
        "Step 1: Basic Information": "步骤 1：基本信息",
        "Select Category": "选择分类",
        "Next Step": "下一步",
        "Previous": "上一步",
        "Step 2: Access & Authorization": "步骤 2：访问与授权",
        "Auto-Auth (ZIP Download)": "自动授权 (ZIP下载)",
        "Auto-Auth (Code Display)": "自动授权 (代码显示)",
        "Manual Approval": "人工审批",
        "API Gateway Proxy": "API 网关代理",
        "Step 3: Configuration": "步骤 3：配置",
        "Installer Package (e.g. SAS)": "安装包 (如 SAS)",
        "License Code (e.g. Stata)": "License 代码 (如 Stata)",
        "Instruction Guide (e.g. Matlab)": "操作指引 (如 Matlab)",
        "Upload License/Auth ZIP. System injects Watermark.": "上传 License/Auth ZIP。系统将注入水印。",
        "File Exists": "文件已存在",
        "Display Static Code after approval.": "审批通过后显示静态代码。",
        "Display Instructions after approval.": "审批通过后显示指引。",
        "Compute Mode:": "计算模式：",
        "Users need to agree to usage norms.": "用户需同意使用规范。",
        "API Mode:": "API 模式：",
        "System manages token quota.": "系统管理 Token 配额。",
        "Data Mode:": "数据模式：",
        "Manual approval for dataset access.": "数据集访问需人工审批。",
        "Review & Submit": "审核并提交",
        "Preview Card": "预览卡片",
        "Save Changes": "保存更改",
        "Create Resource": "创建资源",
        "Preview Resource Card": "预览资源卡片",
        "Footer Institution": "教务处-实验教学管理中心",
        "Footer Contact": "联系电话 028-87092348 颐德楼i507"
    },
    "en": {
        "Software": "Software",
        "Compute": "Compute",
        "Data": "Data",
        "Teaching": "Teaching",
        "API": "API",
        "Other": "Other",
        "Resource Catalog": "Resource Catalog",
        "My Resources": "My Resources",
        "Login via SWUFE Unified Auth": "Log in with SWUFE Unified Authentication Account",
        "Login to Apply": "Login to Apply",
        "Logout": "Logout",
        "Resource Authorization Platform": "Resource Auth Platform",
        "Download Installer": "Download Installer",
        "Download License": "Download License",
        "Apply / Request Access": "Apply / Request Access",
        "Instant Approval": "Instant Approval",
        "Requires Manual Audit": "Requires Manual Audit",
        "Pending Approval...": "Pending Approval...",
        "Already Authorized": "Already Authorized",
        "Authentication required": "Authentication required",
        "Expires": "Expires",
        "Admin Console": "Admin Console",
        "Pending Approvals": "Pending Approvals",
        "Active Resources": "Active Resources",
        "Total Requests": "Total Requests",
        "App ID": "App ID",
        "Priority": "Priority",
        "User Info": "User Info",
        "Resource": "Resource",
        "Submission Details": "Submission Details",
        "Time": "Time",
        "Actions": "Actions",
        "HIGH": "HIGH",
        "NORMAL": "NORMAL",
        "No pending applications": "No pending applications",
        "Resource Configuration": "Resource Configuration",
        "Edit": "Edit",
        "Delete": "Delete",
        "Top Requested Resources": "Top Requested Resources",
        "Recent Audit Logs": "Recent Audit Logs",
        "Admin": "Admin",
        "Action": "Action",
        "Details": "Details",
        "IP": "IP",
        "Reject Application": "Reject Application",
        "Reason for Rejection": "Reason for Rejection",
        "Cancel": "Cancel",
        "Submit Application": "Submit Application",
        "New Resource Wizard": "New Resource Wizard",
        "Resource Name": "Resource Name",
        "Category": "Category",
        "Description / Introduction": "Description / Introduction",
        "Valid Until (Expiry Date)": "Valid Until (Expiry Date)",
        "Authorization Type": "Authorization Type",
        "Public Installer URL (All Software)": "Public Installer URL",
        "Upload Auth/License ZIP": "Upload Auth/License ZIP",
        "Inject Filename": "Inject Filename",
        "License Code / Key": "License Code / Key",
        "Instruction Text": "Instruction Text",
        "Usage Norms / Agreement": "Usage Norms / Agreement",
        "Connection Info Template": "Connection Info Template",
        "Default Token Quota": "Default Token Quota",
        "Upstream API Endpoint": "Upstream API Endpoint",
        "Wait...": "Wait...",
        "Usage Description": "Usage Description",
        "No resources available in this category.": "No resources available in this category.",
        "Apply for Resource": "Apply for Resource",
        "Decrypt Tool": "Decrypt Tool",
        "Active": "Active",
        "License Code": "License Code",
        "Activation Guide": "Activation Guide",
        "Refer to email for access instructions.": "Refer to email for access instructions.",
        "No approved resources yet.": "No approved resources yet.",
        "View Details": "View Details",
        "Close": "Close",
        "Reason": "Reason",
        "Describe the resource features and version...": "Describe the resource features and version...",
        "Paste license key or code here...": "Paste license key or code here...",
        "Loading preview...": "Loading preview...",
        "Empty Archive": "Empty Archive",
        "Archive Preview (Unsaved)": "Archive Preview (Unsaved)",
        "Preview Error": "Preview Error",
        "User Management": "User Management",
        "Approve": "Approve",
        "Reject": "Reject",
        "Legacy Storage. Re-upload required.": "Legacy Storage. Re-upload required.",
        "Are you sure?": "Are you sure?",
        "requests": "requests",
        "Are you sure you want to reject this application?": "Are you sure you want to reject this application?",
        "Not eligible...": "Not eligible...",
        "Re-apply": "Re-apply",
        "Previous Status": "Previous Status",
        "Re-apply for Resource": "Re-apply for Resource",
        "E-TRAP Login": "E-TRAP Login",
        "Experimental Teaching Resource Authorization Platform": "Experimental Teaching Resource Authorization Platform",
        "Dev Mode: Any username creates a new user.": "Dev Mode: Any username creates a new user.",
        "Student/Staff ID": "Student/Staff ID",
        "Enter your ID": "Enter your ID",
        "Password": "Password",
        "Enter Password": "Enter Password",
        "Login": "Login",
        "Create an Account": "Create an Account",
        "Register": "Register",
        "Name": "Name",
        "Department": "Department",
        "Phone": "Phone",
        "Email": "Email",
        "Already have an account? Login": "Already have an account? Login",
        "Complete Profile": "Complete Profile",
        "Please complete your profile to continue.": "Please complete your profile to continue.",
        "Register New User": "Register New User",
        "Student/Staff ID (Unique)": "Student/Staff ID (Unique)",
        "Unique ID (e.g. 2021001)": "Unique ID (e.g. 2021001)",
        "Full Name": "Full Name",
        "Your Name": "Your Name",
        "Department (School)": "Department (School)",
        "e.g. School of Finance": "e.g. School of Finance",
        "Phone Number": "Phone Number",
        "Email Address": "Email Address",
        "Register & Login": "Register & Login",
        "Complete Your Profile": "Complete Your Profile",
        "You must update your contact info to continue.": "You must update your contact info to continue.",
        "Save & Continue": "Save & Continue",
        "Decrypt Trace Info": "Decrypt Trace Info",
        "Back to Dashboard": "Back to Dashboard",
        "Upload Encrypted File (e.g. lic.dat)": "Upload Encrypted File (e.g. lic.dat)",
        "Decrypt": "Decrypt",
        "Decrypted Result:": "Decrypted Result:",
        "User ID (DB)": "User ID (DB)",
        "Username (SWUFE UID)": "Username (SWUFE UID)",
        "Application ID": "Application ID",
        "Apply Time (Approved)": "Apply Time (Approved)",
        "Download Time": "Download Time",
        "User Management - E-TRAP Admin": "User Management - E-TRAP Admin",
        "Dashboard": "Dashboard",
        "Search name/ID/email": "Search name/ID/email",
        "Search": "Search",
        "UID": "UID",
        "Role": "Role",
        "Status": "Status",
        "Actions": "Actions",
        "Disabled": "Disabled",
        "No users found": "No users found",
        "Details": "Details",
        "User Detail - E-TRAP Admin": "User Detail - E-TRAP Admin",
        "Back to Users": "Back to Users",
        "User Profile": "User Profile",
        "Disable Account": "Disable Account",
        "Enable Account": "Enable Account",
        "Change Role": "Change Role",
        "Update": "Update",
        "User Applications": "User Applications",
        "Revoke All": "Revoke All",
        "Are you sure you want to revoke ALL active applications for this user?": "Are you sure you want to revoke ALL active applications for this user?",
        "Revoke access? This cannot be undone.": "Revoke access? This cannot be undone.",
        "No applications found": "No applications found",
        "Revoke": "Revoke",
        "Resource": "Resource",
        "Date": "Date",
        "Action": "Action",
        "Statistics": "Statistics",
        "Total Authorizations": "Total Authorizations",
        "Active Authorizations": "Active Authorizations",
        "Expiring Soon (7 Days)": "Expiring Soon (7 Days)",
        "Authorization Trends": "Authorization Trends",
        "Authorization Distribution": "Authorization Distribution",
        "Start Date": "Start Date",
        "End Date": "End Date",
        "Filter": "Filter",
        "Resource Name": "Resource Name",
        "Category": "Category",
        "Count": "Count",
        "No data available": "No data available",
        "Footer Institution": "Dean's Office - Experimental Teaching Management Center",
        "Footer Contact": "Contact: 028-87092348 Yide Building i507"
    }
}

def get_translator(request: Request):
    # Get lang from cookie, default to zh
    lang = request.cookies.get("lang", "zh")
    if lang not in TRANSLATIONS:
        lang = "zh"
            
    def translate(key):
        return TRANSLATIONS.get(lang, {}).get(key, key)
        
    return translate, lang
