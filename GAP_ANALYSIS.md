# 功能差异分析报告 (GAP Analysis)

本文档对比了《产品需求文档 (PRD v2.1)》与当前系统代码实现 (v2.0)，列出了已实现、部分实现及未实现的功能模块，供后续开发迭代参考。

## 1. 核心功能模块 (Core Modules)

| 模块 | 功能点 | 状态 | 说明 |
| :--- | :--- | :---: | :--- |
| **2.1 用户前台** | | | |
| **A. 资源大厅** | 四大板块展示 (软件/算力/API/数据) | ✅ 已实现 | 前端 `resources.html` 支持 Tab 切换，后端模型支持 `category` 字段。 |
| | 未申请/已授权状态区分 | ✅ 已实现 | 已实现不同的 UI 展示逻辑（申请按钮 vs 下载/查看按钮）。 |
| **B. 智能申请向导** | 身份预填充 | ✅ 已实现 | 基于 SSO 或本地登录用户信息。 |
| | 动态表单 (不同资源不同字段) | ✅ 已实现 | 后端 `Resource.form_schema` 存储 JSON Schema，前端 JS 动态渲染表单。 |
| **C. 个人中心** | 我的授权列表 | ✅ 已实现 | 首页顶部展示 "My Resources" 区域。 |
| | **通知中心 (站内信)** | 🔴 **未实现** | 缺少站内信模型及 UI 界面。 |
| **2.2 管理后台** | | | |
| **A. 审批工作台** | 人工审核流程 | ✅ 已实现 | 支持 Approve/Reject 操作。 |
| | **自动化辅助 (预约检查)** | 🔴 **未实现** | 未对接 `resource.swufe.edu.cn` 进行自动核验。 |
| **B. 资源配置** | 水印配置 (Type A) | ✅ 已实现 | 支持上传 ZIP 并配置注入文件。 |
| | **配额管理 (API Token)** | 🟡 部分实现 | 数据库有 `quota` 字段，但**无实际扣除/限制逻辑**。 |
| | **API Key 池管理** | 🔴 **未实现** | 无法导入上游 Key 池，无法分发下游 Key。 |
| **C. 审计与报表** | 申请记录列表 | ✅ 已实现 | 简单的列表展示。 |
| | **数据看板 (热力图/分布图)** | 🟡 部分实现 | 仅有 Top 5 资源统计，无图表展示。 |
| | 泄露溯源 (解密工具) | ✅ 已实现 | 提供了在线解密工具 (`/admin/tools/decrypt`)。 |

## 2. 业务流程逻辑 (Business Logic)

| 逻辑编号 | 名称 | 状态 | 差异详情 |
| :--- | :--- | :---: | :--- |
| **Logic 1** | **自动化授权与水印** | ✅ 已实现 | 完整实现了 ZIP 流式加密注入，无需生成临时文件。 |
| **Logic 2** | **人工审核与双通道通知** | 🟡 部分实现 | 审核状态流转已完成，但 **缺少 SMS (阿里云) 和 Email (Mailgun) 发送代码**。 |
| **Logic 3** | **API 配额管理** | 🔴 **未实现** | 缺少 API Gateway 转发层，无法拦截请求进行计费和鉴权。 |
| **Logic 4** | **混合预约流程** | 🔴 **未实现** | 目前仅作为普通文本表单处理，未实现双向预约状态同步。 |

## 3. 技术与集成 (Tech & Integration)

| 组件 | 需求 | 状态 | 备注 |
| :--- | :--- | :---: | :--- |
| **身份认证** | CAS / SSO | ✅ 已实现 | 实现了基于 Ticket 的 CAS 验证 (`backend/core/cas_client.py`)。 |
| **消息通知** | Aliyun SMS SDK | 🔴 **未实现** | 代码库中无相关依赖和工具类。 |
| | Mailgun API | 🔴 **未实现** | 代码库中无相关依赖和工具类。 |
| **数据转发** | Data Proxy (Wind/CSMAR) | 🔴 **未实现** | 暂无相关模块。 |
| **AI 辅助** | AI Assistant Integration | 🔴 **未实现** | 暂无相关模块。 |

## 4. 建议优先补充功能 (High Priority Tasks)

基于 MVP (最小可行性产品) 的目标，建议优先补充以下功能：

1.  **通知系统集成 (Logic 2)**: 即使没有短信，至少实现邮件通知 (SMTP 或 Mailgun)，否则用户无法得知审核结果。
2.  **API 网关基础版 (Logic 3)**: 对于 LLM 资源，目前仅分发静态 Key 极其危险。建议实现一个简单的转发 Endpoint (如 `/api/v1/proxy/{resource_id}`) 来隐藏上游 Key。
3.  **前端细节优化**: 增加"使用文档"或"Wiki"页面的链接，目前仅在 Alert 框中显示简短文本。
